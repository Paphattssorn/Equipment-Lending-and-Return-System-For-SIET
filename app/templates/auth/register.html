{% extends 'base/base.html' %}
{% block title %}Sign in | SEIT KMITL{% endblock %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/register.css') }}">
<section class="auth">
  <h1 class="auth__heading">sign in</h1>

  <div class="auth__card">
    <form class="auth__form" method="post" action="{{ url_for('auth.register_action') }}">
      {% if error %}<div class="auth__alert auth__alert--error">{{ error }}</div>{% endif %}
      {% if success %}<div class="auth__alert auth__alert--success">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</div>{% endif %}

      <div class="auth__grid">
        <div class="auth__field auth__field--full">
          <label class="auth__label">‡∏ä‡∏∑‡πà‡∏≠‚Äì‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
          <input class="auth__input" type="text" name="name" value="{{ old.name if old else '' }}" required>
        </div>

        <div class="auth__field auth__field--full">
          <label class="auth__label">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label>
          <input class="auth__input" type="text" name="student_id" value="{{ old.student_id if old else '' }}" required>
        </div>

        <div class="auth__field">
          <label class="auth__label">‡πÄ‡∏û‡∏®</label>
          <select class="auth__input" name="gender" required>
            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏®</option>
            <option value="male"   {% if old and old.gender=='male' %}selected{% endif %}>‡∏ä‡∏≤‡∏¢</option>
            <option value="female" {% if old and old.gender=='female' %}selected{% endif %}>‡∏´‡∏ç‡∏¥‡∏á</option>
            <option value="other"  {% if old and old.gender=='other' %}selected{% endif %}>‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</option>
          </select>
        </div>

        <div class="auth__field">
          <label class="auth__label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</label>
          <select class="auth__input" name="member_type" required>
            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</option>
            <option value="student" {% if old and old.member_type=='student' %}selected{% endif %}>‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
            <option value="teacher" {% if old and old.member_type=='teacher' %}selected{% endif %}>‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå</option>
            <option value="staff"   {% if old and old.member_type=='staff' %}selected{% endif %}>‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</option>
          </select>
        </div>

        <div class="auth__field auth__field--full">
          <label class="auth__label">‡∏™‡∏≤‡∏Ç‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤</label>
          <input class="auth__input" type="text" name="major" value="{{ old.major if old else '' }}" required>
        </div>

        <div class="auth__field auth__field--full">
          <label class="auth__label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
          <input class="auth__input" type="tel" name="phone" value="{{ old.phone if old else '' }}" required>
        </div>

        <div class="auth__field auth__field--full">
          <label class="auth__label">‡∏≠‡∏µ‡πÄ‡∏°‡∏• (‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏™‡∏ñ‡∏≤‡∏ö‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)</label>
          <input class="auth__input" type="email" name="email" placeholder="xxxxx@kmitl.ac.th" value="{{ old.email if old else '' }}" required>
        </div>

        <div class="auth__field auth__field--full">
          <label class="auth__label">Password</label>
          <input class="auth__input" type="password" name="password" required>
        </div>

        <div class="auth__field auth__field--full">
          <label class="auth__label">Confirm-Password</label>
          <input class="auth__input" type="password" name="confirm_password" required>
        </div>
      </div>

      <button class="auth__submit" type="submit">Register</button>
    </form>
  </div>
</section>

<!-- ===== Success Popup (Markup) ===== -->
<div id="regSuccess" class="auth-success" aria-hidden="true">
  <div class="auth-success__card" role="dialog" aria-modal="true" aria-labelledby="regSuccTitle">
    <div class="check-wrap">
      <svg class="check-svg" viewBox="0 0 64 64" aria-hidden="true">
        <circle class="check-circle" cx="32" cy="32" r="28"></circle>
        <path class="check-mark" d="M18 33 L28 43 L46 24"></path>
      </svg>
    </div>
    <h3 id="regSuccTitle" class="auth-success__title">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h3>
    <p class="auth-success__desc">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ üéâ</p>
    <button class="auth-success__btn" onclick="goLogin()">‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Login</button>
    <script>
      function goLogin() {
        window.location.href = "{{ url_for('auth.login_page') }}";
      }
    </script>

  </div>
</div>

<!-- ===== Success Popup (Script) ===== -->
<script>
  function openSuccess() {
    const o = document.getElementById('regSuccess');
    if (!o) return;
    o.classList.add('active');
    o.setAttribute('aria-hidden','false');
  }
  function closeSuccess() {
    const o = document.getElementById('regSuccess');
    if (!o) return;
    o.classList.remove('active');
    o.setAttribute('aria-hidden','true');
  }

  // ‡πÇ‡∏ä‡∏ß‡πå‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠ backend ‡∏™‡πà‡∏á success=True
  {% if success %}
  window.addEventListener('DOMContentLoaded', () => {
    openSuccess();
    // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏î‡πâ‡∏á‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ login ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡∏´‡∏•‡∏±‡∏á 2 ‡∏ß‡∏¥ ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏•‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ
    // setTimeout(() => { window.location.href = "{{ url_for('auth.login_page') }}"; }, 2000);
  });
  {% endif %}
</script>
{% endblock %}
