<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/equipment.css') }}">
    <title>Equipment</title>
</head>
{% extends 'base/base.html' %}
{% block content %}

<h1 class="Title">ระบบยืมอุปกรณ์</h1>

<!-- ช่องค้นหาชื่อ -->
<div class="search-container">
    <input type="text" id="searchInput" placeholder="ค้นหาอุปกรณ์ตามชื่อ..." onkeyup="filterDevices()">
    
    <!-- Dropdown หมวดหมู่ -->
    <select id="categoryFilter" onchange="filterDevices()">
        <option value="">ทุกหมวดหมู่</option>
        {% set categories = equipments | map(attribute='category') | unique %}
        {% for cat in categories %}
        <option value="{{ cat }}">{{ cat }}</option>
        {% endfor %}
    </select>
</div>

<div class="device-container">
{% for item in equipments %}
<div class="device_box"
     data-name="{{ item.name | lower }}"
     data-category="{{ item.category }}"
     style="background-color: {{ item.status_color or 'transparent' }}";>
     
    <!-- แสดงรูป -->
    <img class="image" src="{{ url_for('static', filename=item.image) }}" alt="{{ item.name }}">
    
    <!-- ข้อมูลอุปกรณ์ -->
    <div class="device_info">
      <span class="device_name">{{ item.name }}</span>
      <span class="amount">จำนวนคงเหลือ : {{ item.amount }}</span>
    </div>

    <!-- ปุ่มกด -->
    <div class="button_group">
      <a href="#" class="btn btn-detail">รายละเอียด</a>
      <a href="/equipment/lend" class="btn btn-borrow">ยืม</a>
    </div>
  </div>
{% endfor %}
</div>

<!-- JS สำหรับกรอง -->
<script>
function filterDevices() {
    const searchValue = document.getElementById('searchInput').value.toLowerCase();
    const categoryValue = document.getElementById('categoryFilter').value.toLowerCase();
    const devices = document.querySelectorAll('.device_box');

    devices.forEach(device => {
        const name = device.dataset.name;
        const category = device.dataset.category.toLowerCase();
        if ((name.includes(searchValue)) && (category.includes(categoryValue) || categoryValue === '')) {
            device.style.display = '';
        } else {
            device.style.display = 'none';
        }
    });
}
</script>

{% endblock %}

</html>