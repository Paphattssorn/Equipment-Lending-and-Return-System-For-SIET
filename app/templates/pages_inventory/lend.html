<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/lend.css') }}">
    <title>Document</title>
</head>

{% extends 'base/base.html' %}
{% block title %}ยืมอุปกรณ์{% endblock %}
{% block content %}

<body>
  <!-- Header -->
  <div class="header">
    <i class="ri-file-edit-fill"></i>
    <span>บันทึกการ “ยืม” อุปกรณ์</span>
  </div>

  <!-- Form -->
  <div class="form-container">
    <form>
      <!-- รูป + ชื่ออุปกรณ์ + ID -->
      <div class="top-row">
        <img class="image" src="{{ url_for('static', filename=image) }}" alt="{{ name }}">

        <div class="device-info-box">
          <div class="form-group">
            <label>ชื่ออุปกรณ์</label>
            <input type="text" value="{{ name }}" readonly>
          </div>
          <div class="form-group">
            <label>รหัสอุปกรณ์</label>
            {% if codes|length > 1 %}
              <select name="code">
                {% for c in codes %}
                  <option value="{{ c }}">{{ c }}</option>
                {% endfor %}
              </select>
              
            {% else %}
              <input type="text" value="{{ codes[0] if codes else '' }}" readonly>
            {% endif %}
          </div>

        </div>
      </div>

      <!-- วันที่ยืม + กำหนดคืน -->
      <div class="row">
        <div class="form-group">
          <label>วันที่ยืม</label>
          <!-- ✅ ใช้ now() จาก context processor -->
          <input type="date" value="{{ now().strftime('%Y-%m-%d') }}" readonly>
        </div>
        <div class="form-group">
          <label>วันที่กำหนดคืน</label>
          <input type="date">
        </div>
      </div>

      <!-- ✅ ข้อมูลผู้ยืม -->
      <div class="form-group">
        <label>ชื่อ-นามสกุล</label>
        <input type="text" value="{{ current_user.name }}" readonly>
      </div>

      <div class="form-group">
        <label>เบอร์โทร</label>
        <input type="text" value="{{ current_user.phone }}" readonly>
      </div>

      <div class="form-group">
          <label>สาขา</label>
          <input type="text">
      </div>

      <div class="form-group">
        <label>วิชา</label>
        <input type="text">
      </div>

      <div class="form-group">
        <label>อาจารย์ประจำวิชา</label>
        <input type="text">
      </div>

      <div class="form-group">
        <label>เหตุผลในการยืม</label>
        <textarea rows="3"></textarea>
      </div>

      <div class="button-group">
        <a href="{{ url_for('inventory.lend_device') }}" type="button" class="btn btn-cancel">ยกเลิก</a>
        <a href="#" type="submit" class="btn btn-submit">ยืนยันการยืม</a>
      </div>
    </form>

    <!-- กล่องล่างสุด -->
    <div class="footer-box"></div>
  </div>
</body>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const borrowInput = document.querySelector('input[type="date"][readonly]'); // วันที่ยืม
    const returnInput = document.querySelectorAll('input[type="date"]')[1];    // วันที่กำหนดคืน

    if (borrowInput && returnInput) {
      // วันที่ยืม
      const borrowDate = new Date(borrowInput.value);

      // กำหนด min = วันที่ยืม
      const borrowDateStr = borrowInput.value;
      returnInput.min = borrowDateStr;

      // กำหนด max = วันที่ยืม + 5 วัน
      const maxDate = new Date(borrowDate);
      maxDate.setDate(maxDate.getDate() + 5);

      // แปลงกลับเป็นรูปแบบ yyyy-mm-dd
      const maxDateStr = maxDate.toISOString().split('T')[0];
      returnInput.max = maxDateStr;
    }
  });
</script>



{% endblock %}
</html>
