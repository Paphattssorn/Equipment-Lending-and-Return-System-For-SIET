{% extends 'base/base_admin.html' %}
{% block title %}‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå{% endblock %}
{% set CATEGORIES = ["IT & ‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå","‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏¥‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏£‡∏≠‡∏ô‡∏¥‡∏Å‡∏™‡πå/‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°","‡πÇ‡∏™‡∏ï‡∏ó‡∏±‡∏®‡∏ô‡∏®‡∏∂‡∏Å‡∏©‡∏≤","‡∏Å‡∏µ‡∏¨‡∏≤","‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô "] %}

{% block content %}
<style>
  * { box-sizing: border-box; }

  .page {
    padding: 40px;
    background: #f5f5f5;
    min-height: calc(100vh - 60px);
    display: flex;
    justify-content: center;
    align-items: flex-start;
  }

  .container { width: 100%; max-width: 900px; margin: 0 auto; }
  .header { display: flex; align-items: center; gap: 14px; margin-bottom: 24px; justify-content: center; }
  .header img { width: 48px; height: 48px; }
  .header h1 { font-size: 26px; font-weight: 700; margin: 0; }

  .card {
    background: #ffffff;
    border: 1px solid #cfcfcf;
    border-radius: 12px;
    padding: 40px;
    width: 100%;
    box-shadow: 0 2px 6px rgba(0,0,0,0.06);
  }

  .row { display: flex; flex-direction: column; margin-bottom: 20px; }
  .row label { font-size: 15px; font-weight: 600; margin-bottom: 6px; }
  .ctrl {
    padding: 10px 14px;
    border: 1px solid #cfcfcf;
    border-radius: 8px;
    background: #fff;
    font-size: 15px;
    width: 100%;
  }
  textarea.ctrl { resize: vertical; min-height: 100px; line-height: 1.5; }
  select.ctrl, input.ctrl, textarea.ctrl { display: block; }

  .btns { display: flex; justify-content: flex-end; gap: 12px; margin-top: 28px; }
  .btn {
    padding: 10px 20px;
    border-radius: 8px;
    border: 1px solid #cfcfcf;
    background: #fff;
    cursor: pointer;
    font-size: 15px;
  }
  .btn.primary {
    background: #4caf50;
    color: #fff;
    border-color: #4caf50;
    font-weight: 600;
  }
  .btn.primary:hover { background: #45a049; }

  /* üü© Toggle Switch Style */
  .switch {
    position: relative;
    display: inline-block;
    width: 52px;
    height: 28px;
  }
  .switch input { opacity: 0; width: 0; height: 0; }
  .slider {
    position: absolute;
    cursor: pointer;
    top: 0; left: 0; right: 0; bottom: 0;
    background-color: #ccc;
    transition: .4s;
    border-radius: 34px;
  }
  .slider:before {
    position: absolute;
    content: "";
    height: 22px;
    width: 22px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
  }
  input:checked + .slider {
    background-color: #4caf50;
  }
  input:checked + .slider:before {
    transform: translateX(24px);
  }
</style>

<div class="page">
  <div class="container">
    <div class="header">
      <img src="{{ url_for('static', filename='images/icons/device.png') }}" alt="">
      <h1>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</h1>
    </div>

    <div class="card">
      <form action="{{ url_for('inventory.admin_equipment_edit', eid=item.equipment_id) }}" method="post" enctype="multipart/form-data">

        <div class="row">
          <label>‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå *</label>
          <input class="ctrl" type="text" name="name" value="{{ item.name or '' }}" required>
        </div>

        <div class="row">
          <label>‡∏£‡∏´‡∏±‡∏™/‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç *</label>
          <input class="ctrl" type="text" name="code" value="{{ item.code or '' }}" required>
        </div>

        <div class="row">
          <label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
          <select class="ctrl" name="category">
            <option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà ‚Äî</option>
            {% for c in CATEGORIES %}
              <option value="{{ c }}" {% if item.category == c %}selected{% endif %}>{{ c }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="row">
          <label>‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠</label>
          <input class="ctrl" type="text" name="brand" value="{{ item.brand or '' }}">
        </div>

        <div class="row">
          <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
          <textarea class="ctrl" name="detail">{{ item.detail or '' }}</textarea>
        </div>

        <div class="row">
          <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠</label>
          <input class="ctrl" type="date" name="buy_date"
                 value="{{ item.buy_date.strftime('%Y-%m-%d') if item.buy_date else '' }}">
        </div>

        <div class="row">
          <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
          <select class="ctrl" name="status">
            {% set s = item.status or '' %}
            <option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ‚Äî</option>
            <option value="available" {{ 'selected' if s=='available' else '' }}>‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>
            <option value="in_use"    {{ 'selected' if s=='in_use'    else '' }}>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°</option>
            <option value="broken"    {{ 'selected' if s=='broken'    else '' }}>‡∏ä‡∏≥‡∏£‡∏∏‡∏î</option>
            <option value="lost"      {{ 'selected' if s=='lost'      else '' }}>‡∏™‡∏π‡∏ç‡∏´‡∏≤‡∏¢</option>
          </select>
        </div>

        <!-- ‚úÖ Toggle Switch: ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ -->
        <div class="form-group" style="margin-top:16px; margin-bottom:20px; display:flex; align-items:center; gap:12px;">
          <label class="switch">
            <input type="checkbox" name="require_teacher_approval" {% if item.require_teacher_approval %}checked{% endif %}>
            <span class="slider"></span>
          </label>
          <span style="font-weight:600;">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°</span>
        </div>

        {% if item.images and item.images|length > 0 %}
          {% set latest = (item.images|sort(attribute='created_at', reverse=True))|first %}
          <div class="row">
            <label>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</label>
            <div style="width:150px; height:150px; border:1px solid #ccc; border-radius:8px; overflow:hidden;">
              <img
                src="{{ url_for('static', filename=(latest.image_path|replace('\\','/'))) }}?v={{ (item.updated_at.timestamp() if item.updated_at else 0) }}"
                alt="‡∏£‡∏π‡∏õ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô"
                style="width:100%; height:100%; object-fit:cover;">
            </div>
          </div>
        {% endif %}

        <div class="row">
          <label>‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏°‡πà (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
          <input class="ctrl" type="file" name="image" accept="image/*">
        </div>

        <div class="btns" style="justify-content: space-between; align-items: center;">
          <button type="submit"
                  class="btn"
                  style="background:#dc3545; color:#fff; border-color:#dc3545; font-weight:600;"
                  formaction="{{ url_for('inventory.admin_equipment_delete', eid=item.equipment_id) }}"
                  formmethod="post"
                  formnovalidate
                  onclick="return confirm('‚ùå ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?');">
            üóëÔ∏è ‡∏•‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ
          </button>

          <div style="display:flex; gap:12px;">
            <a class="btn" href="{{ url_for('inventory.admin_equipment_list') }}">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</a>
            <button type="submit" class="btn primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
